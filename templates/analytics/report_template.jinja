{% extends "base.jinja" %}

{% block title %}{{ report_type }} Report - RankTutor{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-900">{{ report_title|default('Analytics Report') }}</h1>
        <div class="text-sm text-gray-600">
            <p>Period: {{ start_date }} to {{ end_date }}</p>
            <p>Generated: {{ "now"|date('F d, Y h:i A') }}</p>
        </div>
    </div>
    
    {% if report_type == 'Bookings' %}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tutor</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Subject</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for booking in bookings %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.student.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.tutor.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.subject.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.lesson_date }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">{{ booking.get_status_display() }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹{{ booking.total_amount }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif report_type == 'Revenue' %}
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Summary</h2>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <p class="text-sm text-gray-600">Total Revenue</p>
                <p class="text-2xl font-bold text-green-600">₹{{ total_revenue|floatformat(2) }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-600">Total Commission</p>
                <p class="text-2xl font-bold text-blue-600">₹{{ total_commission|floatformat(2) }}</p>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Student</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tutor</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for payment in payments %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ payment.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ payment.created_at|date('M d, Y') }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ payment.student.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ payment.tutor.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹{{ payment.amount }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">{{ payment.get_status_display() }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif report_type == 'Tutors' %}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">City</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">State</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rating</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for tutor in tutors %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.user.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.user.email }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.city }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.state }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ tutor.average_rating|default('0.0') }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">{{ tutor.get_verification_status_display() }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif report_type == 'Users' %}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Username</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Role</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date Joined</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Active</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for user in users %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.id }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.username }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.email }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.get_role_display() }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.date_joined|date('M d, Y') }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">{{ 'Yes' if user.is_active else 'No' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <div class="mt-6">
        <a href="{{ url('analytics:report_builder') }}" class="bg-gray-300 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-400">
            ← Back to Report Builder
        </a>
    </div>
</div>
{% endblock %}

