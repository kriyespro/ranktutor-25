{% extends "base.jinja" %}

{% block title %}Process Payment - RankTutor{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Process Payment</h1>
    
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Booking Details</h2>
        <div class="space-y-3">
            <div>
                <p class="text-sm text-gray-500">Tutor</p>
                <p class="text-lg font-semibold">{{ booking.tutor.get_full_name()|default(booking.tutor.username) }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Subject</p>
                <p class="text-lg font-semibold">{{ booking.subject.name }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Date & Time</p>
                <p class="text-lg font-semibold">{{ booking.lesson_date|date('F d, Y') }} at {{ booking.lesson_time|date('h:i A') }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Duration</p>
                <p class="text-lg font-semibold">{{ booking.duration_hours }} hour{{ 's' if booking.duration_hours != 1 else '' }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Mode</p>
                <p class="text-lg font-semibold">{{ booking.get_mode_display() }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Payment Summary</h2>
        <div class="space-y-3">
            <div class="flex justify-between">
                <p class="text-gray-600">Amount</p>
                <p class="text-lg font-semibold">₹{{ amount|floatformat(2) }}</p>
            </div>
            <div class="flex justify-between text-sm text-gray-500">
                <p>Platform Commission ({{ commission_percentage }}%)</p>
                <p>₹{{ commission_amount|floatformat(2) }}</p>
            </div>
            <div class="border-t pt-3 flex justify-between">
                <p class="text-lg font-semibold">Total Amount</p>
                <p class="text-2xl font-bold text-indigo-600">₹{{ amount|floatformat(2) }}</p>
            </div>
        </div>
    </div>
    
    {% if payment and payment.status == 'completed' %}
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
        <p class="text-green-800">Payment already completed. <a href="{{ url('payments:detail', payment_id=payment.id) }}" class="underline">View payment details</a></p>
    </div>
    {% else %}
    <form method="POST" class="bg-white rounded-lg shadow p-6">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        
        <div class="mb-6">
            <label for="payment_method" class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
            <select name="payment_method" id="payment_method" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                <option value="razorpay" selected>Razorpay</option>
                <option value="stripe">Stripe</option>
            </select>
        </div>
        
        <div class="mb-6">
            <label for="transaction_id" class="block text-sm font-medium text-gray-700 mb-2">Transaction ID (Optional - for testing)</label>
            <input type="text" name="transaction_id" id="transaction_id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" placeholder="Leave empty for auto-generated">
            <p class="mt-1 text-sm text-gray-500">In production, this will be automatically generated by the payment gateway.</p>
        </div>
        
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
            <p class="text-sm text-yellow-800">
                <strong>Note:</strong> This is a demo payment system. In production, this would redirect to the actual payment gateway (Stripe/Razorpay) for secure payment processing.
            </p>
        </div>
        
        <div class="flex gap-4">
            <button type="submit" class="flex-1 bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                Process Payment
            </button>
            <a href="{{ url('bookings:detail', booking_id=booking.id) }}" class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-300 text-center">
                Cancel
            </a>
        </div>
    </form>
    {% endif %}
</div>
{% endblock %}

